<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Register â€” Makarios Emporium</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Poppins', sans-serif; }
  body { background:#f8f8f8; display:flex; justify-content:center; align-items:center; height:100vh; }
  .register-container { background:#fff; padding:2rem; border-radius:10px; width:100%; max-width:400px; box-shadow:0 5px 20px rgba(0,0,0,0.1); }
  h2 { text-align:center; margin-bottom:1.5rem; color:#111; }
  label { display:block; margin-bottom:.3rem; font-weight:500; }
  input { width:100%; padding:.7rem; margin-bottom:1rem; border:1px solid #ccc; border-radius:6px; }
  button { width:100%; padding:.7rem; border:none; background:#e53935; color:#fff; font-weight:600; border-radius:6px; cursor:pointer; }
  .google-btn { background:#4285F4; margin-top:1rem; }
  .links { text-align:center; margin-top:1rem; font-size:.9rem; }
  .links a { color:#e53935; text-decoration:none; margin:0 .3rem; }
</style>
<script type="module" src="../firebase.js"></script>
</head>
<body>

<div class="register-container">
  <h2>Create Account</h2>

  <form id="registerForm">
    <label for="email">Email</label>
    <input type="email" id="email" required placeholder="Enter your email">
    
    <label for="password">Password</label>
    <input type="password" id="password" required placeholder="Enter your password">
    
    <button type="submit">Register</button>
  </form>

  <button type="button" id="googleRegister" class="google-btn">
    Sign up with Google
  </button>

  <div class="links">
    <span>Already have an account?</span>
    <a href="login.html">Login</a>
    <br>
    <a href="../index.html">Back to Home</a>
  </div>
</div>

<script type="module">
import { auth, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "../firebase.js";
import { db, doc, setDoc } from "../firebase.js";

const registerForm = document.getElementById("registerForm");
const googleBtn = document.getElementById("googleRegister");

// Email/password registration
registerForm.addEventListener("submit", async e => {
  e.preventDefault();
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Save user info in Firestore
    await setDoc(doc(db, "users", user.uid), {
      name: user.email.split("@")[0],
      email: user.email,
      role: "client",
      createdAt: new Date()
    });

    localStorage.setItem("role", "client");
    window.location.href = "../index.html";
  } catch (error) {
    alert("Registration failed: " + error.message);
  }
});

// Google Sign-In / Register
googleBtn.addEventListener("click", async () => {
  const provider = new GoogleAuthProvider();
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;

    // Save user info in Firestore if not exist
    const userRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userRef);
    if(!userSnap.exists()) {
      await setDoc(userRef, {
        name: user.displayName,
        email: user.email,
        role: "client",
        createdAt: new Date()
      });
    }

    localStorage.setItem("role", "client");
    window.location.href = "../index.html";
  } catch (error) {
    alert("Google Sign-In failed: " + error.message);
  }
});
</script>
</body>
</html>
